{% extends "base.html" %}
{% load static %}
{% load tags %}
{% load cart_tags %}

{% block page_header %}
<div class="container">
    <div class="row">
        <div class="col"></div>
    </div>
</div>
{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="row">
        {% if cart_items %}
        <div class="col">
            <div class="card pt-4">
                <table id="cart-items" class="table-responsive mb-1">
                    <thead>
                        <tr>
                            <th scope="col"></th>
                            <th scope="col">Name</th>
                            <th scope="col">Qty</th>
                            <th scope="col">Price</th>
                            <th scope="col"></th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in cart_items %}
                        <tr>
                            <td><img class="cart-image" src="{{ MEDIA_URL }}{{ item.item|use_media:'COVER.src' }}"
                                    alt="{{ item.item|use_media:'COVER.descr' }}"></td>
                            <td>{{ item.item.name }}</td>
                            <td>{{ item.quantity }}</td>
                            <td>{{ item.item.final_price|multiply:item.quantity }}</td>
                            <td class="remove-item"><button role="button" data-id="{{ item.item.id }}"
                                    class="remove-item__btn btn btn-sm btn-danger" data-bs-toggle="tooltip" data-bs-title="Remove Game"><i
                                        class="fa-solid fa-xmark"></i></button></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {% else %}
        <div class="empty-cart col-8 d-flex flex-row align-items-center py-2">
            <img src="{{ MEDIA_URL }}customer-profile-glados-portal-game.webp" alt="">
            <div class="bubble pt-2 pb-1 px-3 ms-4 d-flex flex-column align-items-center">
                <h2 class="fs-2">It's not often I encounter an empty cart in this facility. I'm almost impressed by your
                    lack of items.</h2>
                <a href="{% url 'games' %}" class="btn btn-outline-gamebox mb-2">KEEP LOOKING</a>
            </div>
        </div>
        {% endif %}
        <div class="col-4">
            <div class="card">
                <div class="card-body">
                    <h2 class="card-title">Some other stuff here:</h2>
                </div>
            </div>
        </div>
        {% if not cart_items %}
        <div class="col-8 mt-2">
            <small>
                Just like the witty character who inspired it, this message is meant to be humorous. No judgment here!
                We do however encourage you to keep exploring our selection of games! &#59;&#41;
            </small>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block postloadjs %}
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
    const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
    const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))

    let removeItemBtns = document.querySelectorAll('.remove-item__btn')
    console.log(removeItemBtns)

    removeItemBtns.forEach(btn => {
        let btnParentRow = btn.parentNode.parentNode
        let gameId = btn.dataset.id
        btn.addEventListener('click', function (event) {
            console.log(btnParentRow);
            console.log(gameId)
        })
        btn.addEventListener('keydown', function (event) {
            if (event.key === 'Enter' || event.key === ' ') {
                console.log(btnParentRow);
                console.log(gameId)
            }
        });
    })

    function removeCartItem(item) {
        console.log(item)
    }

    // removeCartItem(item);
</script>
{% endblock %}